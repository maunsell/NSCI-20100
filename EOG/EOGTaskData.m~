classdef EOGTaskData < handle
    % saccades
    %   Support for processing eye traces and detecting saccades
    
    properties
        counter = 0;
     	offsetsDeg;
        numOffsets;
        stepSign;
        offsetIndex;
        offsetsDone;
        blocksDone;
        sampleRateHz;
        saccadeDurS;
        saccadeSamples;
        trialDurS;
        trialSamples;
        prestimDurS;
        taskState;
        trialStartTimeS;
        samplesRead;
        dataState;
        numSummed;
        rawData;
        posTrace;
        posSummed;
        posAvg;
        velTrace;
        velSummed;
        velAvg;
    end
    
    methods
        function obj = EOGTaskData(numChannels, sampleRateHz)

             %% Object Initialization %%
             obj = obj@handle();                                            % object initialization

             %% Post Initialization %%
            obj.offsetsDeg = [4 8 12 16];
            obj.numOffsets = length(obj.offsetsDeg);
            obj.stepSign = 1;
            obj.offsetIndex = 1;
            obj.offsetsDone = zeros(1, obj.numOffsets);
            obj.blocksDone = 0;
            obj.sampleRateHz = sampleRateHz;
            obj.saccadeDurS = 0.25;
            obj.saccadeSamples = floor(obj.saccadeDurS * obj.sampleRateHz);
            obj.trialDurS = max(0.50, 2 * obj.saccadeDurS);
            obj.trialSamples = floor(obj.trialDurS * obj.sampleRateHz);
            obj.prestimDurS = min(obj.trialDurS / 4, 0.250);
            obj.taskState = TaskState.taskIdle;
            obj.dataState = DataState.dataIdle;
            obj.trialStartTimeS = 0;
            obj.samplesRead = 0;
            obj.numSummed = zeros(1, obj.numOffsets);
            obj.rawData = zeros(obj.trialSamples, numChannels);             % raw data
            obj.posTrace = zeros(obj.trialSamples, 1);                     	% trial EOG position trace
            obj.posSummed = zeros(obj.saccadeSamples, obj.numOffsets);      % summed position traces
            obj.posAvg = zeros(obj.saccadeSamples, obj.numOffsets);         % averaged position traces
            obj.velTrace = zeros(obj.trialSamples, 1);                      % trial EOG velocity trace
            obj.velSummed = zeros(obj.saccadeSamples, obj.numOffsets);      % summed position traces
            obj.velAvg = zeros(obj.saccadeSamples, obj.numOffsets);         % averaged position traces
        end

        %% clearAll
        function clearAll(obj)
            taskData.offsetsDone = zeros (1, taskData.numOffsets);
            taskData.blocksDone = 0;
            taskData.numSummed = zeros(1, taskData.numOffsets);
            taskData.rawData = zeros(taskData.trialSamples, handles.lbj.numChannels);    % raw data
            taskData.posTrace = zeros(taskData.trialSamples, 1);                         % trial EOG position trace
            taskData.posSummed = zeros(taskData.saccadeSamples, taskData.numOffsets);    % summed position traces
            taskData.posAvg = zeros(taskData.saccadeSamples, taskData.numOffsets);       % averaged position traces
            taskData.velTrace = zeros(taskData.trialSamples, 1);                         % trial EOG velocity trace
            taskData.velSummed = zeros(taskData.saccadeSamples, taskData.numOffsets);    % summed position traces
            taskData.velAvg = zeros(taskData.saccadeSamples, taskData.numOffsets);       % averaged position traces
            taskData.saccDur = zeros(1, taskData.numOffsets);                            % average saccade duration
            handles.taskData = taskData;                                                     end
    end
    
    
end

